<script>"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var MzPropz=function(){function e(t){_classCallCheck(this,e),this.type,this.containerClass=t.containerClass||".propz-container-div",this.clickToActivateOfferText=t.clickToActivateOfferText||"Ativar Oferta",this.activatedOfferText=t.activatedOfferText||"Oferta Ativada!",this.addToCartText=t.addToCartText||"Adicionar ao Carrinho",this.clickToLoginText=t.clickToLoginText||"Clique para se logar",this.signUpButtonText=t.signUpButtonText||"Clique para se cadastrar",this.addToCartCallback=t.addToCartCallback||this.defaultAddToCartCallback,this.failedAddToCartCallback=t.failedAddToCartCallback||this.defaultFailedAddToCartCallback,this.shelfHtml=t.shelfHtml||this.getShelfHtml(),this.vtexSigninHtml=t.vtexSigninHtml||this.getVtexSigninHtml(),this.signupHtml=t.signupHtml||this.getSignupHtml(),this.slickConfig=t.slickConfig||this.getSlickConfig(),this.shelfHtmlSkeleton=t.shelfHtmlSkeleton||this.getShelfHtmlSkeleton(),this.loginSignupSkeleton=t.signupSkeleton||this.getLoginSignupSkeleton(),this.priceFormatter=t.priceFormatter||this.defaultPriceFormatter}return _createClass(e,[{key:"defaultPriceFormatter",value:function(t){return t.toLocaleString("pt-br",{style:"currency",currency:"BRL"})}},{key:"defaultAddToCartCallback",value:function(t,e,n,o){}},{key:"defaultFailedAddToCartCallback",value:function(){}},{key:"init",value:function(){var t=this,e=0,n=setInterval(function(){25<e?clearInterval(n):(vtexjs&&vtexjs.checkout&&vtexjs.checkout.orderForm&&(clearInterval(n),vtexjs.checkout.orderForm.loggedIn?t.type="shelf":t.type="signup",t.initPropz()),e++)},200)}},{key:"initPropz",value:function(){var e,n=this,t=this.containerClass,o=$(t);o.length?"shelf"==this.type?(e=vtexjs.checkout.orderForm.clientProfileData.document)&&(this.showSigninSkeleton(),this.getUser(e).then(function(t){t&&t.userData?(n.showShelfSkeleton(),n.getPromotions(e).then(function(t){t&&t.promotions&&(n.renderShelfs(o,t.promotions),$(window).off("propz.productAddedToCart").on("propz.productAddedToCart",n.addToCartCallback),$(window).off("propz.failedProductAddedToCart").on("propz.failedProductAddedToCart",n.failedAddToCartCallback))})):n.getForm().then(function(t){t=' <a class="mz-propz-btn-link mz-propz-button" href='.concat(t.formUrl,">\n                                                <button>").concat(n.signUpButtonText,"</button>\n                                            </a>"),t=n.signupHtml.format({signUpBtn:t});$(o).html(t)})})):"signup"==this.type&&(this.showSigninSkeleton(),t='<button onClick="MzPropz.propzLogin()">'.concat(this.clickToLoginText,"</button>"),t=this.vtexSigninHtml.format({clickToLoginBtn:t}),$(o).html(t)):console.warn("Div .propz-container-div não foi encontrada")}},{key:"renderShelfs",value:function(t,e){for(var n=[],o=$('<div class="mz-propz-shelf-slick"></ul>'),i=0;i<e.length;i++)n.push(this.shelf(e[i],i));o.append(n),$(t).html(o),o.slick(this.slickConfig)}},{key:"shelf",value:function(t,e){var n=t.items[0].images[0].imageUrl,o=t.items[0].nameComplete,i=this.priceFormatter(t.priceRange.listPrice.highPrice),r=this.priceFormatter(t.priceRange.sellingPrice.lowPrice),a=t.link,s=t.activated,l=t.items[0].itemId,c=t.properties.find(function(t){return"sellerId"==t.name}),c=c&&c.values?c.values[0]:1,c='\n                <div class="mz-buy-button-block">\n                    <div class="mz-propz-activate-promo'.concat(s?" active":"",'">\n                        <button ').concat(s?"disabled=true":""," onClick='MzPropz.activateItem({index},event,{activated},\"{activatedOfferText}\")'>\n                        ").concat(s?this.activatedOfferText:this.clickToActivateOfferText,'\n                        </button>\n                    </div>\n                    <div class="mz-propz-button').concat(s?" active":"",'">\n                        <button ').concat(s?"":"disabled=true"," onClick='").concat(1==t.items.length?"MzPropz.addToCart({skuId},{sellerId},this)":'window.location.href="{productUrl}"',"'>\n                            ").concat(this.addToCartText,"\n                        </button>\n                    </div>\n                </div>\n        ").format({activated:s,index:e,skuId:l,sellerId:c,activatedOfferText:this.activatedOfferText,productUrl:a});return this.shelfHtml.format({productUrl:a,imgUrl:n,name:o,listPrice:i,sellingPrice:r,buttonTemplate:c})}},{key:"buildString",value:function(){return function(t){for(var e=arguments.length,n=new Array(1<e?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i="";return t.forEach(function(t,e){i+=t+n[e]}),i}}},{key:"showShelfSkeleton",value:function(){for(var t=this.shelfHtmlSkeleton,e=$('<div class="mz-propz-skeleton-container"></div>'),n=[],o=this.slickConfig.slidesToShow||5,i=0;i<o;i++)n.push($(t));$(".propz-container-div").html(e.append(n))}},{key:"showSigninSkeleton",value:function(){var t=this.loginSignupSkeleton;$(".propz-container-div").html(t)}},{key:"getUser",value:function(s){var l=this;return new Promise(function(e,t){try{var n=localStorage.getItem("mzPropzUser");if(!n)return l.getUserRequest(s).then(function(t){return e(t)});var o=JSON.parse(n),i=localStorage.getItem("mzPropzUserTime"),r=new Date(i).getTime()+864e5,a=(new Date).getTime();if(!(o&&o.cpf&&o.cpf==s&&a<r))return l.getUserRequest(s).then(function(t){return e(t)});e(o)}catch(t){return console.warn("Ocorreu um erro ao tentar recuperar o usuário - Refazendo chamada: "+t.message),l.getUserRequest(s).then(function(t){return e(t)})}})}},{key:"getUserRequest",value:function(e){return $.ajax("/api/io/get-client?document="+e).then(function(t){return localStorage.setItem("mzPropzUser",JSON.stringify({cpf:e,userData:t})),localStorage.setItem("mzPropzUserTime",new Date),{cpf:e,userData:t}})}},{key:"getPromotions",value:function(s){var l=this;return new Promise(function(e,t){try{var n=localStorage.getItem("mzPropzPromotions");if(!n)return l.getPromotionsRequest(s).then(function(t){return e(t)});var o=JSON.parse(n),i=localStorage.getItem("mzPropzPromotionsTime"),r=new Date(i).getTime()+864e5,a=(new Date).getTime();if(!(o&&o.cpf&&o.cpf==s&&a<r))return l.getPromotionsRequest(s).then(function(t){return e(t)});e(o)}catch(t){return l.getPromotionsRequest(s).then(function(t){return e(t)})}})}},{key:"getPromotionsRequest",value:function(e){return $.ajax("/api/io/get-product-list?document="+e).then(function(t){return localStorage.setItem("mzPropzPromotions",JSON.stringify({promotions:t,cpf:e})),localStorage.setItem("mzPropzPromotionsTime",new Date),{promotions:t,cpf:e}})}},{key:"getForm",value:function(){var a=this;return new Promise(function(e,t){try{var n=localStorage.getItem("mzFormPropz"),o=localStorage.getItem("mzFormPropzTime"),i=new Date(o).getTime()+864e5,r=(new Date).getTime();if(!(n&&r<i))return a.getFormRequest().then(function(t){return e(t)});e(JSON.parse(n))}catch(t){return a.getFormRequest().then(function(t){return e(t)})}})}},{key:"getFormRequest",value:function(){return $.ajax("/api/io/get-form").then(function(t){return localStorage.setItem("mzFormPropz",JSON.stringify(t)),localStorage.setItem("mzFormPropzTime",new Date),localStorage.setItem("@propz/store-id",JSON.stringify(t.storeId)),t})}},{key:"getSlickConfig",value:function(){return{infinite:!0,dots:!0,slidesToShow:5,slidesToScroll:5,lazyLoad:"ondemand",responsive:[{breakpoint:1024,settings:{slidesToShow:4,slidesToScroll:4,infinite:!0}},{breakpoint:622,settings:{slidesToShow:1,slidesToScroll:1}}]}}},{key:"getShelfHtml",value:function(){return'\n                <div class="mz-propz-shelf">\n                    <div class="mz-propz-shelf-image">\t\t\t\t\n                        <a class="mz-propz-shelf-image-link img-responsive" href="{productUrl}">\n                            <img src="{imgUrl}"/>\n                        </a>\n                    </div>\n                    <div>\n                        <div class="mz-propz-product-name">\n                            <h1>\n                                <a href="{productUrl}" title="{name}">{name}</a>\n                            </h1>\n                        </div>                        \n                        <div class="mz-propz-price-div">\n                            <p class="mz-propz-list-price">\n                                <span>De: </span>\n                                <span>{listPrice}</span>\n                            </p>\n                            <p class="mz-propz-selling-price">\n                                <span>Para: </span>\n                                <span>{sellingPrice}</span>\n                            </p>\n                        </div>                    \n                        {buttonTemplate}\n                    </div>\n                </div>\n        '}},{key:"getShelfHtmlSkeleton",value:function(){return'<div class="mz-propz-shelf-skeleton"></div>'}},{key:"getLoginSignupSkeleton",value:function(){return'<div class="mz-propz-login-skeleton">\n                    <div class="skeleton-left">\n                        <div class="skeleton-text-container">\n                            <div class="skeleton-header"></div>\n                            <div class="skeleton-body"></div>\n                            <div class="skeleton-button"></div>\n                        </div>\n                    </div>\n                    <div class="skeleton-right">\n                        <div class="skeleton-image"></div> \n                    </div>\n                </div>'}},{key:"getVtexSigninHtml",value:function(){return'\n        <div class="mz-propz-signup-container">\n            <div class="mz-propz-signup-left">\n                <div class="mz-propz-text-container">\n                    <div class="mz-propz-header">Promoções da Propz</div>\n                    <div class="mz-propz-body">Faça login para ver promoções incriveis e feitas para você!</div>\n                    <div class="mz-propz-button">\n                        {clickToLoginBtn}\n                    </div>\n                </div>\n            </div>\n            <div class="mz-propz-signup-right">\n                <img src="https://picsum.photos/id/488/1042/583" alt="">\n            </div>\n        </div>\n    '}},{key:"getSignupHtml",value:function(){return'\n            <div class="mz-propz-signup-container">\n                <div class="mz-propz-signup-left">\n                    <div class="mz-propz-text-container">\n                        <div class="mz-propz-header">Promoções da Propz</div>\n                        <div class="mz-propz-body">Cadastre-se e receba promoções incriveis e feitas para você!</div>\n                        {signUpBtn}\n                    </div>\n                </div>\n                <div class="mz-propz-signup-right">\n                    <img src="https://picsum.photos/id/488/1042/583" alt="">\n                </div>\n            </div>\n        '}}],[{key:"activateItem",value:function(e,n,t,o){var i,r;t||(r=localStorage.getItem("mzPropzPromotions"),t=(i=JSON.parse(r)).promotions[e],r=vtexjs.checkout.orderForm.clientProfileData.document,t&&($(n.target).html("<div class='mz-propz-btn-loading'></div>"),$.ajax({url:"/api/io/post-promotion",type:"POST",method:"POST",data:JSON.stringify({customerId:r,partnerPromotionId:t.promotionId})}).then(function(t){t&&!t.error&&($(n.target).parent().addClass("active"),$(n.target).html(o),$(n.target).attr("onclick",null),$(n.target).attr("disabled",!0),i.promotions[e].activated=!0,localStorage.setItem("mzPropzPromotions",JSON.stringify(i)),$(n.target).closest(".mz-buy-button-block").find(".mz-propz-button button").attr("disabled",!1))})))}},{key:"propzLogin",value:function(){vtexid.start({locale:"pt-br"}),$("html, body").animate({scrollTop:0},"fast")}},{key:"addToCart",value:function(t,e,n){var o={id:t,quantity:1,seller:e||1},i=$(n).text();$(n).html("<div class='mz-propz-btn-loading'></div>"),vtexjs.checkout.addToCart([o],null,jssalesChannel).done(function(t){$(window).trigger("propz.productAddedToCart",[o,t,n])}).fail(function(t){$(window).trigger("propz.failedProductAddedToCart",[o,t,n])}).always(function(){$(n).html(i)})}}]),e}();String.prototype.format=String.prototype.format||function(){var t=this.toString();if(arguments.length){var e,n=_typeof(arguments[0]),o="string"===n||"number"===n?Array.prototype.slice.call(arguments):arguments[0];for(e in o)t=t.replace(new RegExp("\\{"+e+"\\}","gi"),o[e])}return t};</script>